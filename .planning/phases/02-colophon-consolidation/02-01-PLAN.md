---
phase: 02-colophon-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - site/colophon/colophon.json
  - site/colophon/colophon-v1.md
  - site/colophon/colophon-v2.md
  - site/colophon/colophon-v3.md
  - site/colophon/colophon-v4.md
  - site/colophon/colophon-v5.md
  - site/colophon/colophon-v6.md
  - site/colophon/colophon-v7.md
  - site/colophon/colophon-v8.md
  - site/colophon/colophon-v9.md
  - site/colophon.njk
autonomous: true

must_haves:
  truths:
    - 'User visits /colophon/ and sees all 9 versions stacked'
    - 'User sees newest version (v9) at top, oldest (v1) at bottom'
    - 'User sees Version X heading with date range for each entry'
    - 'Colophon files do not appear in blog post listing'
    - 'User can link directly to a specific version via anchor'
  artifacts:
    - path: 'site/colophon/colophon.json'
      provides: 'Directory data file with override:tags'
      contains: 'override:tags'
    - path: 'site/colophon/colophon-v9.md'
      provides: 'Newest colophon version'
      contains: 'Version 9'
    - path: 'site/colophon/colophon-v1.md'
      provides: 'Oldest colophon version'
      contains: 'Version 1'
    - path: 'site/colophon.njk'
      provides: 'Consolidated colophon page template'
      contains: "collections['colophon']"
  key_links:
    - from: 'site/colophon.njk'
      to: "collections['colophon']"
      via: 'Nunjucks collection iteration'
      pattern: "collections\\['colophon'\\]"
    - from: 'site/colophon/colophon.json'
      to: 'colophon collection'
      via: 'override:tags prevents post collection membership'
      pattern: 'override:tags.*colophon'
---

<objective>
Consolidate colophon content by moving 9 blog posts out of the posts directory to remove them from blog listing, while preserving their display on the consolidated colophon page.

Purpose: The colophon page at /colophon/ already exists and pulls in all colophon-tagged posts. Moving files from site/posts/ to site/colophon/ removes them from the blog without breaking the consolidated display.

Output: Colophon files in dedicated directory, out of blog listing, with anchor links for direct version linking.
</objective>

<execution_context>
@/Users/mcravey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mcravey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-colophon-consolidation/02-CONTEXT.md
@.planning/phases/02-colophon-consolidation/02-RESEARCH.md

Key patterns from Phase 1:

- site/now/now.json uses override:tags to control collection membership
- Directory data file must match directory name exactly
- Use | reverse filter for newest-first ordering (already in template)
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create colophon directory and move files</name>
  <files>
    site/colophon/colophon.json
    site/colophon/colophon-v1.md
    site/colophon/colophon-v2.md
    site/colophon/colophon-v3.md
    site/colophon/colophon-v4.md
    site/colophon/colophon-v5.md
    site/colophon/colophon-v6.md
    site/colophon/colophon-v7.md
    site/colophon/colophon-v8.md
    site/colophon/colophon-v9.md
  </files>
  <action>
    1. Create directory site/colophon/

    2. Create site/colophon/colophon.json with:
       {
         "override:tags": ["colophon"]
       }
       Note: Use override:tags (not additive tags) to ensure files are ONLY in colophon collection, not posts collection. This follows the pattern from site/now/now.json.

    3. Move all 9 colophon files from site/posts/ to site/colophon/:
       - git mv site/posts/colophon-v1.md site/colophon/
       - git mv site/posts/colophon-v2.md site/colophon/
       - (repeat for v3 through v9)

       Use git mv to preserve history.

    4. Verify the frontmatter in moved files retains tags: [colophon]. The directory data file's override:tags will take precedence, but having the tag in frontmatter doesn't hurt.

  </action>
  <verify>
    1. Run npm run build (or equivalent) - should complete without errors
    2. Check that site/colophon/ contains 10 files (colophon.json + 9 .md files)
    3. Check built output: colophon files should NOT appear in posts listing
    4. Check /colophon/ page still renders all 9 versions
  </verify>
  <done>
    - site/colophon/ directory exists with colophon.json
    - All 9 colophon-vX.md files are in site/colophon/
    - No colophon files remain in site/posts/
    - Build succeeds
    - /colophon/ page displays all 9 versions
    - Colophon entries do NOT appear in blog/posts listing
  </done>
</task>

<task type="auto">
  <name>Task 2: Add version anchors to colophon template</name>
  <files>site/colophon.njk</files>
  <action>
    Update site/colophon.njk to add id attributes for direct linking to each version.

    Current template:
    ```njk
    {%- for post in posts -%}
      <article class="h-entry">
        <h1 class="post-title p-name">{{ post.title }}</h1>
        ...
      </article>
    {%- endfor -%}
    ```

    Updated template - add id to article element:
    ```njk
    {%- for post in posts -%}
      <article class="h-entry" id="{{ post.data.title | slugify }}">
        <h1 class="post-title p-name">{{ post.title }}</h1>
        ...
      </article>
    {%- endfor -%}
    ```

    This creates anchors like #colophon-v9, #colophon-v8, etc.

    Alternative (cleaner): Extract just the version number if preferred:
    - Parse "Colophon v9" to get "v9"
    - But slugify is simpler and works fine

    Keep it simple - slugify the title.

  </action>
  <verify>
    1. Run build
    2. Check generated HTML for /colophon/ - each article should have id attribute
    3. Test direct link: /colophon/#colophon-v5 should scroll to Version 5
  </verify>
  <done>
    - Each version section has an id attribute for anchor linking
    - Direct URLs like /colophon/#colophon-v5 work
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Build verification:

   - npm run build completes without errors
   - No warnings about missing files or broken collections

2. Page verification (run dev server):

   - /colophon/ shows all 9 versions
   - Version 9 (2023) appears at top
   - Version 1 (2001) appears at bottom
   - Each version has h1 with "Colophon vX" and h3 with year range
   - Intro paragraph appears before versions

3. Collection verification:

   - Blog posts page (/posts/ or index) does NOT show colophon entries
   - Only actual blog posts appear in posts listing

4. Anchor verification:

   - Navigate to /colophon/#colophon-v5
   - Page should scroll to Version 5 section
   - Each article has unique id attribute

5. File structure verification:
   - site/colophon/ contains colophon.json + 9 .md files
   - site/posts/ contains NO colophon-\*.md files
     </verification>

<success_criteria>

- COL-01: Colophon exists as single page at /colophon/ (already true, verify preserved)
- COL-02: All 9 colophon posts consolidated (already true via collection, verify preserved)
- COL-03: Versions stacked reverse chronologically (already true via | reverse, verify preserved)
- COL-04: Each version has visible date/version identifier (already true in content, verify preserved)
- COL-05: Redirects - SKIPPED per user decision (old URLs will 404)
- BONUS: Direct linking to versions via anchors
  </success_criteria>

<output>
After completion, create `.planning/phases/02-colophon-consolidation/02-01-SUMMARY.md`
</output>
