---
phase: 01-now-page-system
plan: 02
type: execute
wave: 2
depends_on: ['01-01']
files_modified:
  - site/now/archive.njk
  - includes/now-nav.njk
  - layouts/now.njk
autonomous: true

must_haves:
  truths:
    - 'User can view archive listing at /now/archive/ with all dated versions'
    - 'User can navigate between now page versions using Previous/Next links'
    - 'User can click dated archive link and view historical now page'
    - 'Current now page links to archive listing'
  artifacts:
    - path: 'site/now/archive.njk'
      provides: 'Archive listing page'
      contains: 'collections.now'
    - path: 'includes/now-nav.njk'
      provides: 'Previous/next navigation component'
      contains: 'getPreviousCollectionItem'
    - path: 'layouts/now.njk'
      provides: 'Updated layout with archive link and nav include'
      contains: 'now-nav.njk'
  key_links:
    - from: 'site/now/archive.njk'
      to: 'collections.now'
      via: 'collection iteration'
      pattern: "collections\\.now"
    - from: 'includes/now-nav.njk'
      to: 'collections.now'
      via: 'collection item filters'
      pattern: 'getPreviousCollectionItem|getNextCollectionItem'
    - from: 'layouts/now.njk'
      to: 'includes/now-nav.njk'
      via: 'template include'
      pattern: 'include.*now-nav'
---

<objective>
Complete the now page archive system: archive listing page at `/now/archive/`, previous/next navigation between versions, and link from current now page to archive.

Purpose: Enables users to browse the history of now page updates, fulfilling the archive requirements (NOW-05, NOW-06, NOW-07). Builds on the foundation from Plan 01.

Output: Working archive listing, previous/next navigation on now pages, and complete now page system ready for use.
</objective>

<execution_context>
@/Users/mcravey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mcravey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-now-page-system/01-CONTEXT.md
@.planning/phases/01-now-page-system/01-RESEARCH.md
@.planning/phases/01-now-page-system/01-01-SUMMARY.md

Key existing files:
@layouts/now.njk
@site/now/now.json
@site/now/index.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create archive listing page</name>
  <files>
    site/now/archive.njk
  </files>
  <action>
Create `site/now/archive.njk` for the archive listing:

Frontmatter:

- `title: "Now Page Archive"`
- `layout: page` (use page layout, not now layout - this is a listing, not a now page)
- `permalink: /now/archive/`
- Do NOT include `tags: now` (this page is not a now update, it's a listing)

Content:

- Brief intro: "Previous updates to my now page:"
- Unordered list iterating over `collections.now | reverse` (newest first)
- Each item shows: date (linked to archive URL) using `prettyDate` filter
- Link href uses `entry.url` (generated from now.json computed permalink)

CRITICAL: Use `| reverse` filter in Nunjucks, NOT `.reverse()` method (mutates collection in place - pitfall from research).

Auto-generated summary (Claude's discretion per CONTEXT.md): Use first 100 characters of content via Nunjucks truncate filter, or just date if content extraction is complex.
</action>
<verify>
Run `npm run build` - build succeeds.
Run `npm run dev` and visit `http://localhost:8080/now/archive/` - page renders with list of now pages.
Verify list shows newest first.
Verify dates link to dated archive URLs.
</verify>
<done>
Archive listing page exists at `/now/archive/`.
Shows all now pages in reverse chronological order.
Each entry has date linking to its archive URL.
</done>
</task>

<task type="auto">
  <name>Task 2: Create previous/next navigation and update layout</name>
  <files>
    includes/now-nav.njk
    layouts/now.njk
  </files>
  <action>
Create `includes/now-nav.njk` for previous/next navigation:
- Use `getPreviousCollectionItem` and `getNextCollectionItem` filters (built-in Eleventy)
- Set `previousNow` and `nextNow` variables from `collections.now`
- Render nav element only if either prev or next exists
- Link text: "Previous" and "Next" (per CONTEXT.md decision)
- Add `rel="prev"` and `rel="next"` attributes for SEO

Update `layouts/now.njk`:

- Include `now-nav.njk` after content
- Add "View previous updates" link to `/now/archive/` at bottom
- Ensure date byline is at top (already done in Plan 01)

Navigation structure should be:

1. Content
2. Previous/Next nav
3. Archive link
   </action>
   <verify>
   Run `npm run build` - build succeeds.
   Visit `http://localhost:8080/now/` - see "View previous updates" link.
   Click archive link - navigates to `/now/archive/`.
   (With only one now page, Previous/Next won't appear - this is correct behavior)
   </verify>
   <done>
   Previous/next navigation component exists and is included in now layout.
   Archive link appears on now pages.
   Navigation is conditional (only shows when prev/next exists).
   </done>
   </task>

<task type="auto">
  <name>Task 3: Create test archive entry to verify navigation</name>
  <files>
    site/now/2026-01-15.md
  </files>
  <action>
Create a test archived now page to verify the full system works:

`site/now/2026-01-15.md`:

- `title: "What I'm Doing Now"`
- `date: 2026-01-15` (earlier date)
- NO permalink override (uses computed `/now/2026-01-15.html`)
- NO nav tags (archived pages don't appear in navigation)
- Brief placeholder content with section headers

This file verifies:

1. Dated permalinks work via now.json computed permalink
2. Archive listing shows multiple entries
3. Previous/Next navigation appears between pages
4. Collection sorting is correct (newest first in archive, oldest first in navigation)

After verification, this file can remain as the first archived entry or user can replace with real historical content.
</action>
<verify>
Run `npm run build` - build succeeds.
Visit `http://localhost:8080/now/archive/` - shows both entries (Feb 6 and Jan 15).
Visit `http://localhost:8080/now/2026-01-15.html` - renders archived page.
Visit `http://localhost:8080/now/` - shows "Previous" link pointing to Jan 15 entry.
Click Previous - navigates to archived page.
On archived page, "Next" link points to current `/now/`.
</verify>
<done>
Test archive entry exists at `/now/2026-01-15.html`.
Archive listing shows both entries with newest first.
Previous/Next navigation works between pages.
Full now page system is functional.
</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Archive listing at `/now/archive/` shows all now pages, newest first
3. Clicking archive entry navigates to dated URL (`/now/2026-01-15.html`)
4. Current now page at `/now/` shows "View previous updates" link
5. Previous/Next navigation appears when multiple now pages exist
6. Navigation links work correctly between pages
7. Archived pages use dated URL format (`/now/YYYY-MM-DD.html`)
</verification>

<success_criteria>

- NOW-05: Each now update gets dated archive at `/now/<date>.html` [COVERED]
- NOW-06: Archive listing exists at `/now/archive/` with all dated versions [COVERED]
- NOW-07: Now pages link to previous version for navigation [COVERED]

Complete Phase 1 success criteria:

1. User visits `/now/` and sees current focus areas with visible last-updated date
2. User visits `/now/archive/` and sees list of all previous now page versions with dates
3. User clicks on dated archive link and views historical now page at stable permalink
4. User navigates between now page versions using previous/next links
5. User clicks nownownow.com link and learns about the now page movement
   </success_criteria>

<output>
After completion, create `.planning/phases/01-now-page-system/01-02-SUMMARY.md`
</output>
